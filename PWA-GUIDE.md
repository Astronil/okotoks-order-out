# PWA Implementation Guide - Okotoks Order Out

This document explains how the Progressive Web App (PWA) works and how to test it.

## üöÄ What Was Implemented

### 1. **Vite PWA Plugin Configuration**
- Installed `vite-plugin-pwa` package
- Configured in `vite.config.js` with:
  - Auto-update service worker (`registerType: 'autoUpdate'`)
  - Development mode enabled for testing
  - Custom caching strategies

### 2. **Web App Manifest**
- **Name**: Okotoks Order Out
- **Short Name**: Triple O
- **Theme Color**: #0f172a (Deep Navy)
- **Background Color**: #ffffff (White)
- **Display Mode**: Standalone (app-like experience)
- **Orientation**: Portrait
- **Icons**: 192x192 and 512x512 (need to be added)

### 3. **Service Worker**
- Automatically generated by vite-plugin-pwa
- **Caching Strategies**:
  - **Cache-First**: Static assets (JS, CSS, HTML, images)
  - **Network-First**: API calls and external resources
  - **Stale-While-Revalidate**: External images (Unsplash)
- **Auto-Update**: Service worker updates automatically when new version is deployed

### 4. **Offline Support**
- Custom offline page (`/offline`)
- Branded offline message
- Retry connection button
- Automatic detection of online/offline status

### 5. **Install Prompt**
- Custom install banner component
- Detects `beforeinstallprompt` event
- Shows "Install Triple O App" button
- Remembers user dismissal (7 days)
- Works on mobile and desktop

### 6. **Performance Optimizations**
- **Lazy Loading**: All routes use React.lazy()
- **Code Splitting**: Each page loads independently
- **Loading States**: Smooth loading spinner during route transitions

## üì± How Service Worker Works

1. **Registration**: 
   - Service worker is automatically registered by vite-plugin-pwa
   - Happens on first page load
   - Runs in background

2. **Caching**:
   - On first visit: Caches all static assets
   - On subsequent visits: Serves from cache (faster)
   - Updates cache when new version is available

3. **Offline Mode**:
   - When offline, serves cached content
   - If page not cached, shows offline fallback page
   - Images and assets work offline if previously cached

4. **Update Strategy**:
   - `autoUpdate` mode: Updates automatically
   - No manual refresh needed
   - Users get latest version seamlessly

## üîß How Install Works

### Desktop (Chrome, Edge, etc.)
1. User visits website
2. Browser shows install icon in address bar
3. User clicks install icon OR custom install button appears
4. Browser shows install prompt
5. User confirms installation
6. App appears in applications folder / start menu

### Mobile (Android)
1. User visits website in Chrome
2. Browser shows "Add to Home Screen" banner
3. OR custom install prompt appears
4. User taps "Install" or "Add to Home Screen"
5. App icon appears on home screen
6. Opens in standalone mode (no browser UI)

### iOS (Safari)
1. User visits website
2. Taps Share button
3. Selects "Add to Home Screen"
4. App icon appears on home screen
5. Opens in standalone mode

## üß™ How to Test PWA Locally

### Step 1: Install Dependencies
```bash
npm install
```

### Step 2: Build the Project
```bash
npm run build
```

### Step 3: Preview Production Build
```bash
npm run preview
```

### Step 4: Open in Chrome
1. Open `http://localhost:4173` (or the port shown)
2. Open Chrome DevTools (F12)
3. Go to **Application** tab

### Step 5: Check Manifest
1. In Application tab, click **Manifest**
2. Verify:
   - Name: "Okotoks Order Out"
   - Short name: "Triple O"
   - Icons are listed (may show errors if icons missing)
   - Theme color: #0f172a

### Step 6: Check Service Worker
1. In Application tab, click **Service Workers**
2. Verify:
   - Service worker is registered
   - Status: "activated and is running"
   - Source: `sw.js` or similar

### Step 7: Test Offline Mode
1. In Application tab, click **Service Workers**
2. Check **Offline** checkbox
3. Refresh the page (F5)
4. You should see:
   - Cached pages still work
   - Offline page shows if navigating to uncached route
   - Images load from cache

### Step 8: Test Install Prompt
1. In Application tab, click **Manifest**
2. Click **Add to homescreen** button (if available)
3. OR look for install icon in address bar
4. OR wait for custom install prompt to appear

### Step 9: Test Network Tab
1. Go to **Network** tab in DevTools
2. Refresh page
3. Notice:
   - Static assets show "(from ServiceWorker)" or "(from disk cache)"
   - Faster load times on repeat visits

## üåê How to Test Offline Mode

### Method 1: DevTools
1. Open DevTools ‚Üí Network tab
2. Select **Offline** from throttling dropdown
3. Refresh page
4. Navigate between pages
5. Should see offline page for uncached routes

### Method 2: Disconnect Network
1. Disconnect WiFi/Ethernet
2. Refresh page
3. Cached content should still work
4. New routes show offline page

### Method 3: Service Worker Offline
1. DevTools ‚Üí Application ‚Üí Service Workers
2. Check "Offline" checkbox
3. Refresh page
4. Test navigation

## üì¶ How to Deploy to AWS S3 + CloudFront

### Step 1: Build for Production
```bash
npm run build
```

### Step 2: Upload to S3
```bash
# Install AWS CLI if not installed
aws s3 sync dist/ s3://your-bucket-name --delete
```

### Step 3: Configure S3 Bucket
1. Enable static website hosting
2. Set index document: `index.html`
3. Set error document: `index.html` (for SPA routing)

### Step 4: Configure CloudFront
1. Create CloudFront distribution
2. Point to S3 bucket
3. Set default root object: `index.html`
4. Add custom error responses:
   - 403 ‚Üí 200 ‚Üí `/index.html`
   - 404 ‚Üí 200 ‚Üí `/index.html`

### Step 5: Important Headers
Ensure CloudFront serves:
- `Content-Type` headers correctly
- `Cache-Control` headers for service worker
- Service worker must be served with `text/javascript` or `application/javascript`

### Step 6: HTTPS Required
- PWAs require HTTPS
- CloudFront provides HTTPS by default
- Ensure all resources load over HTTPS

### Step 7: Verify Deployment
1. Visit your CloudFront URL
2. Open DevTools ‚Üí Application
3. Check Manifest and Service Worker
4. Test install prompt
5. Test offline mode

## üé® Adding PWA Icons

### Required Files
Place these in `public/` directory:
- `pwa-192x192.png` (192x192 pixels)
- `pwa-512x512.png` (512x512 pixels)

### How to Create
1. Design logo in 512x512px
2. Export as PNG
3. Create 192x192 version
4. Place both in `public/` folder
5. Rebuild: `npm run build`

## üîç Troubleshooting

### Service Worker Not Registering
- Check browser console for errors
- Ensure HTTPS (or localhost)
- Clear browser cache
- Check `vite.config.js` configuration

### Install Prompt Not Showing
- Browser must support PWA
- Must meet installability criteria
- Check manifest is valid
- Try in incognito mode

### Offline Mode Not Working
- Ensure service worker is registered
- Check cache in Application tab
- Verify offline page route exists
- Check network tab for failed requests

### Icons Not Showing
- Verify files exist in `public/`
- Check file names match manifest
- Rebuild after adding icons
- Clear browser cache

## üìä Performance Benefits

- **Faster Load Times**: Cached assets load instantly
- **Offline Access**: Works without internet
- **App-like Experience**: Standalone mode
- **Reduced Data Usage**: Assets cached locally
- **Better UX**: Smooth transitions, loading states

## ‚úÖ Checklist Before Production

- [ ] Add actual PWA icons (192x192 and 512x512)
- [ ] Test on mobile devices
- [ ] Test offline functionality
- [ ] Verify install prompt works
- [ ] Check service worker updates
- [ ] Test on different browsers
- [ ] Verify HTTPS is enabled
- [ ] Test CloudFront deployment
- [ ] Check manifest is valid
- [ ] Verify all routes work offline

## üéØ Next Steps

1. **Add Icons**: Create and add PWA icons
2. **Test Thoroughly**: Test on multiple devices/browsers
3. **Deploy**: Deploy to S3 + CloudFront
4. **Monitor**: Check service worker updates
5. **Optimize**: Monitor performance and cache hits

---

**Note**: The service worker is automatically generated during build. No manual service worker file is needed when using vite-plugin-pwa.

